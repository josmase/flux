apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: gha-runner-scale-set
  namespace: arc-runners
spec:
  chartRef:
    kind: OCIRepository
    name: gha-runner-scale-set
    namespace: flux-system
  interval: 5m
  values:
    runnerScaleSetName: "my-runners"
    githubConfigUrl: "https://github.com/josmase"
    githubConfigSecret: controller-manager
  postRenderers:
    - kustomize:
        patchesStrategicMerge:
          - kind: Deployment
            apiVersion: apps/v1
            metadata:
              name: gha-runner-scale-set
            spec:
              template:
                metadata:
                  labels:
                    app.kubernetes.io/version: "{{ .Chart.Version | replace \"+\" \"_\" }}"